var e={441:(e,t,n)=>{var a;!function(o,r,l){if(o){for(var i,c={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},s={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},u={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},d={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},p=1;p<20;++p)c[111+p]="f"+p;for(p=0;p<=9;++p)c[p+96]=p.toString();k.prototype.bind=function(e,t,n){var a=this;return e=e instanceof Array?e:[e],a._bindMultiple.call(a,e,t,n),a},k.prototype.unbind=function(e,t){return this.bind.call(this,e,(function(){}),t)},k.prototype.trigger=function(e,t){var n=this;return n._directMap[e+":"+t]&&n._directMap[e+":"+t]({},e),n},k.prototype.reset=function(){var e=this;return e._callbacks={},e._directMap={},e},k.prototype.stopCallback=function(e,t){if((" "+t.className+" ").indexOf(" mousetrap ")>-1)return!1;if(g(t,this.target))return!1;if("composedPath"in e&&"function"==typeof e.composedPath){var n=e.composedPath()[0];n!==e.target&&(t=n)}return"INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable},k.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},k.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(c[t]=e[t]);i=null},k.init=function(){var e=k(r);for(var t in e)"_"!==t.charAt(0)&&(k[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},k.init(),o.Mousetrap=k,e.exports&&(e.exports=k),void 0===(a=function(){return k}.call(t,n,t,e))||(e.exports=a)}function y(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function f(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return c[e.which]?c[e.which]:s[e.which]?s[e.which]:String.fromCharCode(e.which).toLowerCase()}function m(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function h(e,t,n){return n||(n=function(){if(!i)for(var e in i={},c)e>95&&e<112||c.hasOwnProperty(e)&&(i[c[e]]=e);return i}()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function b(e,t){var n,a,o,r=[];for(n=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),o=0;o<n.length;++o)a=n[o],d[a]&&(a=d[a]),t&&"keypress"!=t&&u[a]&&(a=u[a],r.push("shift")),m(a)&&r.push(a);return{key:a,modifiers:r,action:t=h(a,r,t)}}function g(e,t){return null!==e&&e!==r&&(e===t||g(e.parentNode,t))}function k(e){var t=this;if(e=e||r,!(t instanceof k))return new k(e);t.target=e,t._callbacks={},t._directMap={};var n,a={},o=!1,l=!1,i=!1;function c(e){e=e||{};var t,n=!1;for(t in a)e[t]?n=!0:a[t]=0;n||(i=!1)}function s(e,n,o,r,l,i){var c,s,u,d,p=[],y=o.type;if(!t._callbacks[e])return[];for("keyup"==y&&m(e)&&(n=[e]),c=0;c<t._callbacks[e].length;++c)if(s=t._callbacks[e][c],(r||!s.seq||a[s.seq]==s.level)&&y==s.action&&("keypress"==y&&!o.metaKey&&!o.ctrlKey||(u=n,d=s.modifiers,u.sort().join(",")===d.sort().join(",")))){var f=!r&&s.combo==l,h=r&&s.seq==r&&s.level==i;(f||h)&&t._callbacks[e].splice(c,1),p.push(s)}return p}function u(e,n,a,o){t.stopCallback(n,n.target||n.srcElement,a,o)||!1===e(n,a)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(n),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(n))}function d(e){"number"!=typeof e.which&&(e.which=e.keyCode);var n=f(e);n&&("keyup"!=e.type||o!==n?t.handleKey(n,function(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(e),e):o=!1)}function p(e,r,l,d,y){t._directMap[e+":"+l]=r;var m,h=(e=e.replace(/\s+/g," ")).split(" ");h.length>1?function(e,t,r,l){function s(t){return function(){i=t,++a[e],clearTimeout(n),n=setTimeout(c,1e3)}}function d(t){u(r,t,e),"keyup"!==l&&(o=f(t)),setTimeout(c,10)}a[e]=0;for(var y=0;y<t.length;++y){var m=y+1===t.length?d:s(l||b(t[y+1]).action);p(t[y],m,l,e,y)}}(e,h,r,l):(m=b(e,l),t._callbacks[m.key]=t._callbacks[m.key]||[],s(m.key,m.modifiers,{type:m.action},d,e,y),t._callbacks[m.key][d?"unshift":"push"]({callback:r,modifiers:m.modifiers,action:m.action,seq:d,level:y,combo:e}))}t._handleKey=function(e,t,n){var a,o=s(e,t,n),r={},d=0,p=!1;for(a=0;a<o.length;++a)o[a].seq&&(d=Math.max(d,o[a].level));for(a=0;a<o.length;++a)if(o[a].seq){if(o[a].level!=d)continue;p=!0,r[o[a].seq]=1,u(o[a].callback,n,o[a].combo,o[a].seq)}else p||u(o[a].callback,n,o[a].combo);var y="keypress"==n.type&&l;n.type!=i||m(e)||y||c(r),l=p&&"keydown"==n.type},t._bindMultiple=function(e,t,n){for(var a=0;a<e.length;++a)p(e[a],t,n)},y(e,"keypress",d),y(e,"keydown",d),y(e,"keyup",d)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a={};(()=>{n.d(a,{Z:()=>w});var e=n(441),t=n.n(e);let o={};const r={tabTitle:"CCC YouTube Timestamp",settings:[{id:"grabTitleKey",name:"Grab Title Shortkey",description:"Paste the video title into the focused block",action:{type:"input",placeholder:"alt+a t",onChange:e=>{o.grabTitleKey=e.target.value}}},{id:"grabTimeKey",name:"Time Stamp Shortkey",description:"Paste the current playing time at the beginning of the focused block",action:{type:"input",placeholder:"alt+a n",onChange:e=>{o.grabTimeKey=e.target.value}}},{id:"normalSpeedKey",name:"Normal Speed Shortkey",description:"Set the playback speed to normal",action:{type:"input",placeholder:"alt+a 0",onChange:e=>{o.normalSpeedKey=e.target.value}}},{id:"speedUpKey",name:"Speed up by .25x Shortkey",description:"Increase the playback speed by .25x",action:{type:"input",placeholder:"alt+a =",onChange:e=>{o.speedUpKey=e.target.value}}},{id:"speedDownKey",name:"Speed down by .25x Shortkey",description:"Decrease the playback speed by .25x",action:{type:"input",placeholder:"alt+a -",onChange:e=>{o.speedDownKey=e.target.value}}},{id:"muteKey",name:"Mute Shortkey",description:"Mute the playback audio",action:{type:"input",placeholder:"alt+a m",onChange:e=>{o.muteKey=e.target.value}}},{id:"volUpKey",name:"Vol Up Shortkey",description:"Increase volume",action:{type:"input",placeholder:"alt+a i",onChange:e=>{o.volUpKey=e.target.value}}},{id:"volDownKey",name:"Vol Down Shortkey",description:"Decrease volume",action:{type:"input",placeholder:"alt+a k",onChange:e=>{o.volDownKey=e.target.value}}},{id:"playPauseKey",name:"Play Pause Shortkey",description:"Play/Pause the player",action:{type:"input",placeholder:"alt+a p",onChange:e=>{o.playPauseKey=e.target.value}}},{id:"backwardKey",name:"Backward Shortkey",description:"Go Backward",action:{type:"input",placeholder:"alt+a j",onChange:e=>{o.backwardKey=e.target.value}}},{id:"forwardKey",name:"ForwardKey Shortkey",description:"Go Forward",action:{type:"input",placeholder:"alt+a l",onChange:e=>{o.forwardKey=e.target.value}}},{id:"playFromTsKey",name:"Play from Timestamp Shortkey",description:"While typing in a block press this to start playing from the time stamp of the current block",action:{type:"input",placeholder:"alt+a ,",onChange:e=>{o.playFromTsKey=e.target.value}}}]};let l=[],i=null;const c=new Map;function s(){for(let e of c.values())if(1==e.getPlayerState())return e;return null}function u(){for(let[e,t]of c)if(null!==document.querySelector('iframe[id$="'+e+'"]'))return t;return null}function d(){let e=s();return null!==e?e:null!==i?i:c.size>0?u():null}const p=e=>new Promise((t=>setTimeout(t,e)));async function y(e){let t=document.querySelector("textarea.rm-block-input").id.slice(-9),n=m(t),a=n;const o=n.match(/{{\[\[ccc\-yt\-timestamp\]\]\:........\(\(.........\)\)}}.*/);o&&o[0]&&(a=n.substring(46)),await f(t,e+a);const r=(e+a).length;window.roamAlphaAPI.ui.setBlockFocusAndSelection({location:window.roamAlphaAPI.ui.getFocusedBlock(),selection:{start:r,end:r}})}const f=async(e,t)=>window.roamAlphaAPI.updateBlock({block:{uid:e,string:t}}),m=e=>window.roamAlphaAPI.q(`[:find (pull ?block [:block/string])\n    :where [?block :block/uid "${e}"]]`)[0][0].string;function h(e){for(let t of e){for(let e of t.addedNodes)if(1===e.nodeType){const t=e.querySelectorAll(".rm-xparser-default-ccc-yt-timestamp");for(let e of t)if(!e.closest(".rm-zoom")){const t=e.closest(".rm-block-ref");let n;n=t?t.dataset.uid:e.closest(".rm-block__input").id.slice(-9);const a=m(n).match(/{{\[\[ccc\-yt\-timestamp\]\]\:(.*)\(\((.*)\)\)}}/);a&&a[1]&&(e.innerHTML=a[1],e.addEventListener("click",(e=>{g(e,a[1],a[2])}))),e.classList.add("timestamp-control")}}for(let e of t.removedNodes)if(1===e.nodeType){const t=e.querySelector('iframe[id^="yt-"]');t&&c.delete(t.id.slice(-9))}}}function b(e,t){return window.roamAlphaAPI.ui.rightSidebar.addWindow({window:{type:e,"block-uid":t}})}async function g(e,t,n){e.stopPropagation();let a=0;const o=t.match(/(\d\d)\:(\d\d)\:(\d\d)/);a=!o||o.length<4?0:3600*parseInt(o[1])+60*parseInt(o[2])+parseInt(o[3]);let r=c.get(n);r||(await b("block",n),await p(1500)),r=c.get(n);let l=s();l&&l!=r&&l.pauseVideo(),r.seekTo(a,!0),r.playVideo()}function k(e,t,n){let a=e.settings.get(t);return null==a&&e.settings.set(t,n),a||n}let v;const w={onload:function({extensionAPI:e}){v=new MutationObserver(h),v.observe(document.getElementById("app"),{subtree:!0,childList:!0}),o.grabTitleKey=k(e,"grabTitleKey","alt+a t"),o.grabTimeKey=k(e,"grabTimeKey","alt+a n"),o.normalSpeedKey=k(e,"normalSpeedKey","alt+a 0"),o.speedUpKey=k(e,"speedUpKey","alt+a ="),o.speedDownKey=k(e,"speedDownKey","alt+a -"),o.muteKey=k(e,"muteKey","alt+a m"),o.volUpKey=k(e,"volUpKey","alt+a i"),o.volDownKey=k(e,"volDownKey","alt+a k"),o.playPauseKey=k(e,"playPauseKey","alt+a p"),o.backwardKey=k(e,"backwardKey","alt+a j"),o.forwardKey=k(e,"forwardKey","alt+a l"),o.playFromTsKey=k(e,"playFromTsKey","alt+a ,"),e.settings.panel.create(r),function(){let e=setInterval((()=>{if("undefined"==typeof YT||void 0===YT.Player){const t=document.createElement("script");t.src="https://www.youtube.com/iframe_api";const n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),clearInterval(e)}}),1e3),t=window.setInterval((()=>{"undefined"!=typeof YT&&Array.from(document.getElementsByTagName("IFRAME")).filter((e=>e.src.includes("youtube.com"))).forEach((e=>{if(null!==e.closest(".rm-zoom-item"))return;let t;if(!e.classList.contains("yt-activated")){let n=(e=>{let t=e.match(/^(https?:\/\/)?((www\.)?(youtube(-nocookie)?|youtube.googleapis)\.com.*(v\/|v=|vi=|vi\/|e\/|embed\/\/?|user\/.*\/u\/\d+\/)|youtu\.be\/)([_0-9a-z-]+)/i);return t&&11==t[7].length?t[7]:null})(e.src);t="yt-"+e.closest(".roam-block").id;let a=document.createElement("div");a.id=t,e.parentNode.insertBefore(a,e),e.remove();let o=new window.YT.Player(t,{videoId:n}),r=document.getElementById(t);r.classList.add("rm-iframe","rm-video-player","yt-activated"),r.closest("div").classList.add("rm-iframe__container","rm-video-player__container","hoverparent"),c.set(t.slice(-9),o);const l=r.closest(".rm-iframe__spacing-wrapper")?.querySelector(".rm-video-player__comment-button");l.style.display="none"}}))}),1e3);l.push((()=>clearInterval(t)))}(),t().prototype.stopCallback=function(){return!1},t().bind(o.grabTitleKey,(async function(e){if(e.preventDefault(),"textarea"==e.target.localName){let t,n=s();if(n)t=n.getVideoData().title;else{let n=e.target.closest(".roam-block-container").parentElement.closest(".roam-block-container").querySelector("iframe");if(null===n)return!1;t=c.get(n.id.slice(-9)).getVideoData().title}y("**"+t+"**")}return!1}),"keydown"),t().bind(o.playFromTsKey,(async function(e){e.preventDefault();let t=e.target.closest(".rm-block__input").id.slice(-9);const n=m(t).match(/{{\[\[ccc\-yt\-timestamp\]\]\:(.*)\(\((.*)\)\)}}/);if(n&&n[1]){const e=n[1].match(/(\d\d)\:(\d\d)\:(\d\d)/);let t;t=!e||e.length<4?0:3600*parseInt(e[1])+60*parseInt(e[2])+parseInt(e[3]);const a=n[2];let o=c.get(a);o||(await b("block",a),await p(1500)),o=c.get(a);let r=s();r&&r!=o&&r.pauseVideo(),o.seekTo(t,!0),o.playVideo()}return!1}),"keydown"),t().bind(o.grabTimeKey,(async function(e){e.preventDefault();let t=d();return null!==t&&(y("{{[[ccc-yt-timestamp]]:"+new Date(1e3*t.getCurrentTime()).toISOString().substring(11,19)+"(("+t.getIframe().id.slice(-9)+"))}}"),!1)}),"keydown"),t().bind(o.playPauseKey,(async function(e){e.preventDefault();let t=s();return null!==t?(t.pauseVideo(),i=t,!1):null!==i?(i.playVideo(),i=null,!1):c.size>0&&(t=u(),null!==t)&&(t.playVideo(),!1)}),"keydown"),t().bind(o.muteKey,(async function(e){e.preventDefault();let t=d();return null!==t&&(t.isMuted()?t.unMute():t.mute(),!1)}),"keydown"),t().bind(o.volUpKey,(async function(e){e.preventDefault();let t=d();return null!==t&&(t.setVolume(Math.min(t.getVolume()+10,100)),!1)}),"keydown"),t().bind(o.volDownKey,(async function(e){e.preventDefault();let t=d();return null!==t&&(t.setVolume(Math.max(t.getVolume()-10,0)),!1)}),"keydown"),t().bind(o.speedUpKey,(async function(e){e.preventDefault();let t=d();return null!==t&&(t.setPlaybackRate(Math.min(t.getPlaybackRate()+.25,2)),!1)}),"keydown"),t().bind(o.speedDownKey,(async function(e){e.preventDefault();let t=d();return null!==t&&(t.setPlaybackRate(Math.max(t.getPlaybackRate()-.25,0)),!1)}),"keydown"),t().bind(o.normalSpeedKey,(async function(e){e.preventDefault();let t=d();return null!==t&&(t.setPlaybackRate(1,0),!1)}),"keydown"),t().bind(o.forwardKey,(async function(e){e.preventDefault();let t=d();if(null!==t){let e=t.getDuration();return t.seekTo(Math.min(t.getCurrentTime()+10,e),!0),!1}return!1}),"keydown"),t().bind(o.backwardKey,(async function(e){e.preventDefault();let t=d();return null!==t&&(t.getDuration(),t.seekTo(Math.max(t.getCurrentTime()-10,0),!0),!1)}),"keydown")},onunload:function(){v.disconnect(),t().unbind(o.grabTitleKey),t().unbind(o.grabTimeKey),t().unbind(o.normalSpeedKey),t().unbind(o.speedUpKey),t().unbind(o.speedDownKey),t().unbind(o.muteKey),t().unbind(o.volUpKey),t().unbind(o.playPauseKey),t().unbind(o.backwardKey),t().unbind(o.forwardKey),t().unbind(o.playFromTsKey);for(const e of l)e();l=[]}}})();var o=a.Z;export{o as default};